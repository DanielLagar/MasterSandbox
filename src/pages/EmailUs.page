<apex:page id="contactUsPage" sidebar="false" showHeader="false" docType="html-5.0" standardStylesheets="false" applyHtmlTag="false" applyBodyTag="false"
           controller="sf_ContactUsTemplateController" extensions="sf_EmailUsExt,sf_DAMImageProxyCtrl" title="{!brand}" action="{!refreshMain}">
    <!-- CDOY WR172 - Remove DOB Validation from ContactUs Pages ..... action="{!redirectIfTooYoung}" .... removed from end of l
    <!-- some browsers need explicit title tag 92 is half of 99-->
    <!--it's 6mil exp + jkjkjkjkjkjkjkj      ergregerg jgelkrnnff;mferlkfm-->
    <title>{!Brand}</title>
    <!-- WR584 ADDED THE JQUERY TO THE STATIC RESOURCES -->
	<apex:stylesheet value="{!URLFOR($Resource.jQuery1_10_4_CSS)}"/>
    <!--<apex:stylesheet value="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css"/>-->
    <apex:stylesheet value="{!URLFOR ($Resource.sf_EmailUsProductSearchCss)}"/>
    <apex:stylesheet value="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css"/>
 
    <!--<apex:includeScript value="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"/>
    <apex:includeScript value="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"/>-->
    <apex:includeScript value="{!URLFOR($Resource.jQuery1_11_0_min)}"/>
	<apex:includeScript value="{!URLFOR($Resource.jQuery1_10_4_UI)}"/>
    <apex:includeScript value="{!URLFOR($Resource.jquery_validate, '/dist/jquery.validate.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.jquery_validate, '/dist/additional-methods.min.js')}"/>
    <apex:includeScript value="{!URLFOR ($Resource.sf_EmailUsJs)}"/>
    <apex:includeScript value="{!URLFOR ($Resource.sf_jQueryDateFormat)}"/>
    <apex:includeScript value="{!$Resource.sf_jquery_masked_input}"/>
    <apex:includeScript value="{!URLFOR ($Resource.sf_GetAddressString)}"/> 


    <!-- christopher.macduff@accenture.com testing recording field/form abandonment-->
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', {!$Setup.Global_Org_Settings__c.GA_Tracking_Code__c}]);
        _gaq.push(['_trackPageview']);
        
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    	//CDOY WR248 - Products required
        function productSearchRequired() {
			if (document.getElementById('showProducts').value == 'true') {
                
				if (parseInt(document.getElementById('idAddedProducts').value) <= 0
                 && document.getElementById('chkUnableToFind').checked == false) {
				    
				    if (document.getElementById('{!$Component.contactUsPage:ContactUsTemplate:contactUsForm:barcode}').value == '' 
				    && document.getElementById('{!$Component.contactUsPage:ContactUsTemplate:contactUsForm:productsearch}').value == ''){
				        
    					document.getElementById("ProductSearchHeader").style.color = '#ad1c1c';
    					document.getElementById("ProductSearchHeader").style.background = '#ffdbdb';
    					document.getElementById("ProductSearchHeader").style.padding = '20px';
				    } else {
				        
				        document.getElementById("ProductSearchHeader").style.color = 'yellow';
				        document.getElementById("ProductSearchHeader").style.background = 'none';
    					document.getElementById("ProductSearchHeader").style.padding = '0PX';
				        document.getElementById('chkUnableToFind').checked = true;
				        unableToFind();
				        document.getElementById('{!$Component.contactUsPage:ContactUsTemplate:contactUsForm:notableToFindText}').value = '' ;
				        document.getElementById('{!$Component.contactUsPage:ContactUsTemplate:contactUsForm:notableToFindText}').style.borderColor = '#ad1c1c';
				        
				        document.getElementById("notfoundBox").style.borderColor = '#ad1c1c';
				        document.getElementById("notfoundBox").style.color = '#ad1c1c';
				    }
					
					$("html, body").animate({ scrollTop: 0 }, "fast");
                    return false;
				}
				else if (document.getElementById('chkUnableToFind').checked == true &&
				        document.getElementById('{!$Component.contactUsPage:ContactUsTemplate:contactUsForm:notableToFindText}').value == ''){
    				    	document.getElementById("notfoundBox").style.borderColor = '#ad1c1c';
    				        document.getElementById("notfoundBox").style.color = '#ad1c1c';
    				        document.getElementById('{!$Component.contactUsPage:ContactUsTemplate:contactUsForm:notableToFindText}').style.borderColor = '#ad1c1c';
    				        $("html, body").animate({ scrollTop: 0 }, "fast");
				            return false;
				}
				    
				
				else if(document.getElementById('{!$Component.contactUsPage:ContactUsTemplate:contactUsForm:notableToFindText}').value != ''){
				    console.log('NotAbleToFindText is populated');
				    document.getElementById('{!$Component.contactUsPage:ContactUsTemplate:contactUsForm:notableToFindText}').style.borderColor = '#ccc';
				    document.getElementById("notfoundBox").style.color = '#666666';
				    
			
				}
				
			}
			return true;
        }
    </script>
    
    <!--START: Testing getSatisfactioncommuninities widget-->
    <apex:outputpanel rendered="{!IF(langCon.displayWidget == '','false', 'true')}">
        <div id="getsat-widget-{!langCon.displayWidget}"></div> 
            <script type="text/javascript" src="https://loader.engage.gsfn.us/loader.js"></script>
            <script type="text/javascript">
            var widgetNumber = '{!langCon.displayWidget}';
            console.log('widget Number = '+widgetNumber);
            if (document.documentElement.clientWidth > 768) {
                if (typeof GSFN !== "undefined") { GSFN.loadWidget({!langCon.displayWidget},{"containerId":"getsat-widget-{!langCon.displayWidget}"}); }
            }
        </script>
    </apex:outputpanel>
    <!--FIN: Testing getSatisfactioncommuninities widget -->    

    <script type="text/javascript">
    //this has to stay on the page here due to labels
        if (!window.console) {console={log: function () {}} };

        var sfPrimaryTabId = null;
        var imageWidth = '{!prodImageWidth}';
        var imageHeight = '{!prodImageHeight}';
        var defaultImage = '{!URLFOR ($Resource.sf_MissingProductImage)}';
        var addedLabel = '{!JSENCODE(langCon.language_config.Product_Search_Products_Added_Count__c)}'; //CDOY WR288 JSENCODE Added to JS
        var disableFilter = {!brand_config.Disable_brand_filter_on_product_search__c};

        var addText = '{!JSENCODE(langCon.language_config.Product_Search_Add_Product__c)}'; //CDOY WR288 JSENCODE Added to JS
        var noDescription = '{!JSENCODE(langCon.language_config.Product_Results_No_Description__c)}'; //CDOY WR288 JSENCODE Added to JS
        var thisIsWhatWeFound = '{!JSENCODE(langCon.language_config.This_is_what_we_found__c)}'; //CDOY WR288 JSENCODE Added to JS
        var summaryExceededMessage = '{!JSENCODE(langCon.language_config.Summary_Exceeded_Limit__c)}'; //CDOY WR288 JSENCODE Added to JS
        var minimumAge = 0{!langCon.bl_case_minimum_age};
        var imageLoadingGif = '{!URLFOR($Resource.sf_loading_image)}';

        //accepted extensions
        var acceptExt = "{!JSENCODE(langCon.language_config.Contact_Us_Allowed_Attachements__c)}"; //CDOY WR288 JSENCODE Added to JS
        var invalidAttachmentExtMessage = "{!JSENCODE(langCon.language_config.Contact_Us_Invalid_Attachment_Message__c)}"; //CDOY WR288 JSENCODE Added to JS
        var fileIsTooBigMessage = "{!JSENCODE(langCon.language_config.Contact_Us_Attachment_is_too_big_message__c)}"; //CDOY WR288 JSENCODE Added to JS

        
        //a little syntactic sugar
        Number.prototype.inRange = function(low, hi) {
            return this >= low && this <= hi;
        };



        //expects mm/yyyy date
        var getAge = function(mmyyyy) {
            var month = parseInt(mmyyyy.substring(0,2));
            var year = parseInt(mmyyyy.substring(3,7));
            var birthDate = new Date(year, month-1, 1); //0 based months.  THIS is the feature you borrow from perl!?
            var today = new Date();
            var age = today.getFullYear() - birthDate.getFullYear();
            var m = today.getMonth() - birthDate.getMonth();
            if( m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age;
        };

        var getDamImageThumbnailUrlInBulk = function (prodIds) {
            sf_DAMImageProxyCtrl.getDamImageThumbnailUrlInBulk(prodIds, function (result, event) {
                if (event.status) {
                    for (i = 0; i < result.length; i++) {
                        $('#' + result[i].Id).attr('src', result[i].Image_Url_Thumb__c);
                    }
                } else {
                    console.log(event);
                }
            },{escape: false});
        };

        var processAddedProducts = function (prodIds) {
            sf_DAMImageProxyCtrl.getDamImageThumbnailUrlInBulk(prodIds, function (result, event) {
                
                if (event.status) {
                    for (i = 0; i < result.length; i++) {
                        $('.added' + result[i].Id).attr('src', result[i].Image_Url_Thumb__c);
                    }
                } else {
                    console.log(event);
                }
                
                document.getElementById("ProductSearchHeader").style.color = 'black';
	            document.getElementById("ProductSearchHeader").style.background = 'none';
		    	document.getElementById("ProductSearchHeader").style.padding = '0PX';
                
            },{escape: false});
            

            
        };

        jQuery.validator.addMethod("mmyyyy", function(value, element)  {
            return this.optional(element)
                || /^\d\d\/\d\d\d\d$/.test(value)
                && parseInt(value.substring(0,2)).inRange(1,12)
        }, "{!JSENCODE(langCon.language_config.Birthdate_field_validation_error__c)}"); //CDOY WR288 JSENCODE Added to JS

        $.validator.addMethod("dateFormat", function(value,element) {

            var isValid = false;
            console.log ('Expiration date check ', element);
            console.log ( new Date (value) );
            if (value != ''){
                if (new Date (value) != 'Invalid Date') {
                    isValid = true;
                    $(element).val($.format.date(new Date (value), "MM/dd/yyyy"));
                }
            } else {
                isValid = true;
            }
                    

            return isValid;
            
        },
            "Please enter a date in the format mm/dd/yyyy"
        );

        jQuery.validator.addMethod("phone", function(value, element) {
            return this.optional(element) || /^[-0-9+() Xx]{7,40}$/.test(value);
        }, "{!JSENCODE(langCon.language_config.Phone_Field_Validation_Error__c)}"); //CDOY WR288 JSENCODE Added to JS

        var validator;
        var initValidation = function() {
            validator = $('[id$=contactUsForm]').validate({
   
                ignoreTitle: true,
                errorElement: 'span',
                focusInvalid: false,
                invalidHandler: function(form, validator) {
                    var errors = validator.numberOfInvalids();
                    if (errors) {
                          $("html, body").animate({ scrollTop: 0 }, "fast");
                    }
                },

            });

            $('.phoneField').rules ("add", {
                    required : false,
                    phone : true
                }
            );

            if ($('.availableForReturnSelect').length)
            $('.availableForReturnSelect').each(function(){

                $(this).rules ("add", {
                    required : true
                });
            });


            if ($('.sameVersionSelect').length)
            $('.sameVersionSelect').each (function (){
                $(this).rules ("add", {
                    required : true
                });
            });
            

            if ($('.birthdate').length) {
                $('.birthdate').rules ( "add", {
                        required : true,
                        mmyyyy: true
                    }
                );
            }



            if ($('.expirationDate').length>0) {
                $('.expirationDate').mask("99/99/9999");
                $('.expirationDate').rules ( "add", {
                        dateFormat: true
                    }
                );
            }

            if ($('.agerange').length) {
                $('.agerange').rules ( "add", {
                        required : true
                    }
                );
            }



            /* Customised the messages */
            jQuery.validator.messages.required = "{!JSENCODE(langCon.language_config.Field_is_required_message__c)}"; //CDOY WR288 JSENCODE Added to JS
            jQuery.validator.messages.email = "{!JSENCODE(langCon.language_config.Invalid_email_message__c)}"; //CDOY WR288 JSENCODE Added to JS
            jQuery.validator.messages.digits = "{!JSENCODE(langCon.language_config.Number_field_validation_error__c)}"; //CDOY WR288 JSENCODE Added to JS

            console.log ('initValidation', validator);
        };

        var toggleReasonDependentFields = function(reasonEl){
            var reasonForWriting = $(reasonEl).val();
            var reasonIndex = $(reasonEl).find("option:selected").index();
            var reasonIndexClass = 'reasonForWriting'+reasonIndex;
            $("#selectedReasonForWriting input").val(reasonIndexClass); //pass the selected class to controller for convenience
            if(reasonIndex === 4 ){
                $('#productReturnDisclosure').show();
                //$('#contactaddress').removeClass('hidden');
                rerenderAddressForm();
                $('.genderSection').removeClass('hidden');
                if ($('.genderField').length) {
                    $('.genderField').rules ( "add", {
                            required : true
                        }
                    );
                }

            }else{
                $('#productReturnDisclosure').hide();
                //$('#contactaddress').addClass('hidden');
                rerenderAddressForm();
                $('.genderSection').addClass('hidden');
                if ($('.genderField').length) {
                    $('.genderField').rules ("remove");
                }
            }
            var reasonSelector = '.' + reasonIndexClass;
            $('.addQ, .addQSection').not(reasonSelector).hide();
            $(reasonSelector).show();
        };

        $(document).ready(function() {
            init();
        });

        var init = function (){

            if (!window.FileReader){
                //alert('File upload not supported!');
                $('#attachments').remove();
                $('#attachmentsNotSupportedMessage').html('{!JSENCODE(langCon.language_config.Contact_Us_Attachements_Not_Supported__c)}'); //CDOY WR288 JSENCODE Added to JS
            }

            initValidation();
            //remove out of the box styling for submit button
            $('[id$=submitButton]').removeClass('btn');
            $('[id$=submitButton]').removeClass('btnDisabled');

            //if product slider is already in yes position (e.g., due to back button), show product-rows
            if ( $('#showProducts option:selected').text() == 'Yes' ) {
                 $('#product-rows').removeClass('hidden');
            }
            
            //hide additional questions
            $('.addQ').hide();
            
            //handle pre-existing Reason for Writing, e.g., back button
            toggleReasonDependentFields($(".reasonForWriting").get());
        };

    </script>

    <apex:composition template="ContactUsTemplate">
        <apex:define name="body">
            <apex:form id="contactUsForm">
                
                <apex:outputPanel layout="block" styleClass="errorMessagesPanel">
                    <div id="validationError" style="display:none">{!langCon.language_config.Top_of_the_page_error_message__c}</div>
                    <apex:pageMessages id="errorMessages"/>
                </apex:outputPanel>
              

                <div class="section-title">{!langCon.language_config.Contact_Us_Form_Text__c}</div>
                <div id="attachmentsNotSupportedMessage" style="margin:10px 0px; font-weight:bold;"></div>



                <div class="innerForm">
                    
                    <div class="row row-2col">
                        <!-- CDOY WR172 - Allow a way for admin users to use config to reverse the FirstName and Lastname on the contact Us pages. -->
                        <apex:outputPanel rendered="{!IF(langContr.isLastNameFirst == true,'false', 'true')}"> <!--CDOY WR172-->
                            <div class="col-xs-12 col-sm-6 col-md-6 cell-2col">
                                <label for="firstName">{!langCon.language_config.Contact_Us_First_Name__c}</label><span class="required">&nbsp;*</span><br/>
                                <apex:inputText styleClass="form-control required" id="firstName" value="{!firstName}" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case First Name'])" ></apex:inputText>        
                            </div><!-- ./col-md-6 -->
    
                            <div class="col-xs-12 col-sm-6 col-md-6 cell-2col">
                                <label for="lastName">{!langCon.language_config.Contact_Us_Last_Name__c}</label><span class="required">&nbsp;*</span><br/>
                                <apex:inputText styleClass="form-control required" id="lastName" value="{!lastName}" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Last Name'])"></apex:inputText>
                            </div><!-- ./col-md-6 --> 
                        </apex:outputPanel> <!--CDOY WR172-->
                        
                        <apex:outputPanel rendered="{!IF(langContr.isLastNameFirst == true,'true', 'false')}"> <!--CDOY WR172-->
                            <div class="col-xs-12 col-sm-6 col-md- cell-2col">
                                <label for="lastName">{!langCon.language_config.Contact_Us_Last_Name__c}</label><span class="required">&nbsp;*</span><br/>
                                <apex:inputText styleClass="form-control required" id="lastName_Flipped" value="{!lastName}" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Last Name'])"></apex:inputText>
                            </div><!-- ./col-md-6 -->
                            
                            <div class="col-xs-12 col-sm-6 col-md-6 cell-2col">
                                <label for="firstName">{!langCon.language_config.Contact_Us_First_Name__c}</label><span class="required">&nbsp;*</span><br/>
                                <apex:inputText styleClass="form-control required" id="firstName_Flipped" value="{!firstName}" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case First Name'])" ></apex:inputText>        
                            </div><!-- ./col-md-6 -->
                        </apex:outputPanel> <!--CDOY WR172-->

                        <div class="col-xs-12 col-sm-6 col-md-6 cell-2col">
                            <label for="email">{!langCon.language_config.Contact_Us_Email_Address__c}</label><span class="required">&nbsp;*</span><br/>
                            <apex:inputText styleClass="form-control emailField required email" id="email" value="{!email}" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Email'])"></apex:inputText>
                        </div><!-- ./col-md-6 -->
                        <div class="col-xs-12 col-sm-6 col-md-6 cell-2col">
                            <label for="phone">{!langCon.language_config.Contact_Us_Phone__c}</label><br/>
                            <apex:inputText html-placeholder="{!langCon.language_config.Contact_Us_Phone_Placeholder__c}" styleClass="form-control required phoneField" id="phone" value="{!phone}" maxlength="40" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Phone'])"></apex:inputText>
                        </div><!-- ./col-md-6 -->

                        <div class="col-xs-12 col-sm-6 col-md-6 cell-2col">
                            <label for="reasonforwriting">{!langCon.language_config.Contact_Us_Reason_for_Writing__c}</label><span class="required">&nbsp;*</span><br/>
                            <apex:selectList value="{!newCase.reason}" size="1" id="reasonforwriting" styleClass="form-control required reasonForWriting" onChange="toggleReasonDependentFields(this);_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Reason'])">
                                <apex:selectOptions value="{!reasons}" />
                                <!--  apex:actionSupport event="onselect" reRender="contactUsForm" /-->
                            </apex:selectList>
                        </div><!-- ./.col-md-6 -->
                        <!-- CDOY WR172 Removed DOB Contact_Age_Range__c field and Contact_Us_Age__c from contactUs Form-->
                        <!--<div class="col-xs-12 col-sm-6 col-md-6 cell-2col"> -->
                        <!--    <apex:outputPanel layout="none" rendered="{!langCon.bl_show_age_ranges}">-->
                        <!--        <label for="agerange">{!langCon.language_config.Contact_Us_Age__c}</label><span class="required">&nbsp;*</span><br/>-->
                        <!--        <apex:selectList id="agerange" styleClass="form-control agerange" value="{!agerange}" multiselect="false" size="1" onchange="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Age Range'])">-->
                        <!--            <apex:selectOption itemValue="" itemLabel="{!langCon.language_config.Age_Range_Please_Select__c}"/>-->
                        <!--            <apex:selectOption itemValue="1" itemLabel="1-12"/>-->
                        <!--            <apex:selectOption itemValue="2" itemLabel="13-17"/>-->
                        <!--            <apex:selectOption itemValue="3" itemLabel="18+"/>-->
                        <!--        </apex:selectList>-->
                                <!-- <apex:inputField styleClass="form-control required" id="agerange" value="{!newCase.Contact_Age_Range__c}"></apex:inputField> -->
                        <!--    </apex:outputPanel>-->
                        <!--    <apex:outputPanel layout="none" rendered="{!langCon.bl_show_age_mmyyyy}">-->
                        <!--        <label for="birthdate">{!langCon.language_config.Contact_Us_Birth_Date__c}</label><span class="required">&nbsp;*</span><br/>-->
                        <!--        <apex:inputText id="birthdate" styleClass="form-control birthdate" html-placeholder="{!langCon.language_config.Contact_Us_Birth_Date_Placeholder__c}" value="{!birthdate}" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Birthdate'])"/>-->
                                <!-- <apex:inputField styleClass="form-control birthdate" id="birthdate" value="{!newCase.Contact_Birthdate__c}" html-placeholder="{!langCon.language_config.Contact_Us_Birth_Date_Placeholder__c}"></apex:inputField> -->
                        <!--    </apex:outputPanel> -->
                        <!--</div>-->

                        <div class="col-xs-12 col-sm-6 col-md-6 cell-2col genderSection hidden">
                            <apex:outputPanel layout="block" rendered="{!langCon.bl_show_ask_gender}" >
                                <label for="gender">{!langCon.language_config.Contact_Us_Gender__c}</label><span class="required">&nbsp;*</span><br/>
                                <apex:selectList styleClass="form-control genderField " id="gender" value="{!newContact.Gender__c}" multiselect="false" size="1" onchange="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Gender'])" >
                                  <apex:selectOption itemValue="" itemLabel="{!langCon.language_config.Gender_Please_Select__c}"/>
                                  <apex:selectOption itemValue="Not Specified" itemLabel="{!langCon.language_config.Gender_Not_Specified__c}"/>
                                  <apex:selectOption itemValue="Male" itemLabel="{!langCon.language_config.Gender_Male__c}"/>
                                  <apex:selectOption itemValue="Female" itemLabel="{!langCon.language_config.Gender_Female__c}"/>
                                </apex:selectList>
                            </apex:outputPanel>

                        </div><!-- ./.col-md-6 -->
                    </div><!-- ./row -->

                    <div class="emailDivider"></div>

                    <div class="row">
                        <div class="col-md-12">
                            <label class="pull-left" style="margin-left:0;" for="">{!langCon.language_config.Contact_Us_Are_you_emailing_us__c}</label>
                            <span class="pull-left required">&nbsp;*</span>
                            <!-- CDOY WR248 - Products required -->
                            <div class="pull-left onoffswitch ml20">
                                <select id="showProducts" class="form-control" onchange="toggleProducts();_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Specific Product'])">
                                    <option value="false" selected="selected">{!langCon.language_config.Toggle_False__c}</option>
                                    <option value="true">{!langCon.language_config.Toggle_True__c}</option>
                                </select>

                            </div>
                            <div class="clearfix"></div>
                        </div><!-- ./col-md-12 -->
                    </div><!-- ./row -->

                    <div class="emailDivider"></div>

                    <div id="product-rows" class="hidden">
                        <div class="row" >
                            <div class="col-md-12" id="ProductSearchHeader">
                                <label for="">{!langCon.language_config.Contact_Us_Product_Search_Header__c}</label>
                            </div><!-- ./col-md-12 -->
                        </div><!-- ./row -->
						<div id="searchTabs">
                            <ul class="nav nav-pills nav-justified" role="tablist">
                                <li id="barcodeTab" class="active">
                                    <a onclick="showBarcodeSearch();">
                                        <div class="glyph fs1">
                                            <div class="clearfix bshadow0 pbs pointerArrow">
                                                <span class="icon-barcode"></span><span class="mls"> &nbsp;
                                                    {!langCon.language_config.Barcode_Tab__c}</span>
                                            </div>
                                        </div>
                                    </a>

                                </li>
                                <li id="productTab">
                                    <a onclick="showProductSearch();">
                                        <div class="glyph fs1">
                                            <div class="clearfix bshadow0 pbs pointerArrow">
                                                <span class="icon-MagGlass"></span><span class="mls"> &nbsp;
                                                    {!langCon.language_config.Product_Search_Tab__c}</span>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                            </ul>

                            <!-- US764 capture search term -->
                            <apex:inputHidden value="{!productSearchTermText}" id="productSearchTermText"/>

                            <!-- this is a start on barcode search -->
                            <div id="searchContainer" class="mt10">
                                <div id="barcodeSearch">
                                    <div class="pull-left">
                                        <label for="barcode" class="searchLabel">{!langCon.language_config.Barcode_Search_Label__c}</label><br/>
                                        <apex:inputText styleClass="form-control searchInput" id="barcode" onfocus="gtinSearchAutocomplete($(this), '{!brand}', document.getElementById('{!$Component.countryFilter}').value); _gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case UPC'])"></apex:inputText>
                                        <span class="fa fa-spinner fa-spin fa-2x progressSpinner" style="display:none; position: relative;top: -58px; left: 242px;"></span>
                                        <p><apex:outputText styleClass="gtinResultsFound thisIsWhatWeFound" value="{!langCon.language_config.This_is_what_we_found__c}"/></p>
                                    </div>
                                    <div class="pull-right barcodes">
                                    <!-- BARCODES GO HERE -->
                                        <!-- <apex:image value="{!URLFOR($Resource.sf_BarcodeImages, 'EAN-8.png')}" width="{!prodImageWidth}" height="{!prodImageHeight}"/> -->
                                        <!-- <apex:image value="{!URLFOR($Resource.sf_BarcodeImages, 'EAN-13.png')}" width="{!prodImageWidth}" height="{!prodImageHeight}"/> -->
                                        <apex:image value="{!URLFOR($Resource.sf_BarcodeImages, 'EAN-13.gif')}" width="{!prodImageWidth}" height="{!prodImageHeight}"/>
                                        <!-- <apex:image value="{!URLFOR($Resource.sf_BarcodeImages, 'UPC_A.gif')}" width="{!prodImageWidth}" height="{!prodImageHeight}"/> -->
                                        <apex:image value="{!URLFOR($Resource.sf_BarcodeImages, 'UPC_E.gif')}" width="{!prodImageWidth}" height="{!prodImageHeight}"/>
                                        <apex:image value="{!URLFOR($Resource.sf_BarcodeImages, 'UPC-6.png')}" width="{!prodImageWidth}" height="{!prodImageHeight}"/>
                                        <apex:image value="{!URLFOR($Resource.sf_BarcodeImages, 'UPC-12.png')}" width="{!prodImageWidth}" height="{!prodImageHeight}"/>

                                    </div>
                                    <div class="clearfix"></div>

                                    <!-- GTIN RESULTS SECTION -->
                                    <apex:outputPanel layout="block" styleClass="displayedResults" id="gtinDisplayedResults">
                                        <div id="gtinSearchResults" class="searchResults">
                                            <!-- Populated through javascript by the GTIN Search method -->
                                        </div>
                                    </apex:outputPanel>
                                </div><!-- end #barcodeSearch -->

                                <div id="productSearch" style="display:none;">

                                    <!-- BEGIN search section -->
                                    <apex:outputPanel id="searchPanel" styleClass="searchPanel" layout="block">
                                          <apex:outputPanel layout="block" styleClass="searchResultsPanel">
                                              <div class="row">
                                                <div class="col-md-8">
                                                    <label for="productsearch" class="searchLabel">{!langCon.language_config.Product_Search_Label__c}</label><br/>
                                                    <apex:inputText styleClass="form-control searchInput" id="productsearch" html-placeholder="{!langCon.language_config.Product_Search_Placeholder__c}" onfocus="productSearchAutocomplete($(this), '{!brand}', document.getElementById('{!$Component.countryFilter}').value);_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Search Products'])"/>
                                                    <span class="fa fa-spinner fa-spin fa-2x progressSpinner" style="display:none;"></span>
                                                </div><!-- ./col-md-8 -->
                                                </div><!-- ./row -->

                                                <p><apex:outputText styleClass="resultsFound thisIsWhatWeFound" value="{!langCon.language_config.This_is_what_we_found__c}"/></p>

                                                <!-- LOCAL PRODUCTS RESULTS SECTION -->
                                                <apex:outputPanel layout="block" styleClass="displayedResults" id="displayedResults">
                                                    <div id="searchResults" class="searchResults">
                                                        <!-- Populated through javascript by the Product Search method -->
                                                    </div>
                                                </apex:outputPanel>

                                          </apex:outputPanel>
                                    </apex:outputPanel>
                                    <!-- END end search section -->
                                </div><!-- #product-search -->
                                
                                <script type="text/javascript">
                                    var unableToFind = function () {
                                        var sText = '';
                                        $('[id$=notableToFindText]').val('');
                                        
                                        if ($('[id$=barcode]').val() != ''){
                                            sText += $('[id$=barcode]').val();
                                        }

                                        if ($('[id$=productsearch]').val() != ''){

                                            if ($('[id$=barcode]').val() != ''){
                                                sText += ', ';
                                            }

                                            sText += $('[id$=productsearch]').val();
                                        }

                                        $('[id$=notableToFindText]').val(sText);
                                        $('#notfoundBox').toggle();
                                    };
                                </script>

                                <div class="unableToFind">
                                    <label for="countryFilter">{!lang_config.Country_Filter_Label__c}</label><br/>
                                    <apex:inputField styleClass="form-control country" id="countryFilter" value="{!caseForFilter.Country__c}" />
                                </div>

                                <div class="unableToFind">
                                    <!-- CDOY WR248 - Products required -->
                                    <input type="checkbox" styleClass="required" onchange="unableToFind();" id="chkUnableToFind" />
                                    <b>{!langCon.language_config.Contact_Us_Product_Not_Found_Checkbox__c}</b>
                                    
                                    <p/>
                                    <div id="notfoundBox" style="display:none">
                                        {!langCon.language_config.Contact_Us_Product_Not_Found_Label__c} <br/>
                                        <apex:inputText id="notableToFindText" styleClass="form-control searchInput" value="{!newCase.Unable_To_Find_Product__c}"/>
                                    </div>
                                </div>
                            </div><!-- #searchContainer -->

                            <div class="emailDivider"></div>


                            <apex:actionFunction name="addCaseProduct" action="{!addCaseProduct}" reRender="errorMessages, selectedProductsSection" status="sf_ProgressStatus" oncomplete="countCaseProducts(); processAddedProductsUrls(); toggleReasonDependentFields($('.reasonForWriting').get()); clearSearchResults(); initValidation();">
                                <apex:param name="productId" assignTo="{!productId}" value=""/>
                                <apex:param name="selectedGTIN" assignTo="{!selectedGTIN}" value=""/>
                            </apex:actionFunction>

                            <apex:outputPanel layout="block" id="selectedProductsSection">
                                <input type='hidden' id="idAddedProducts" style="display:none" value="{!caseProductWrapperList.size}" />
                                <!-- Selected Products -->
                                <apex:outputPanel layout="block" rendered="{!caseProductWrapperList.size>0}">
                                    <!-- US772 add disclosure -->
                                    <p id="productReturnDisclosure" style="display:none"><i>
                                        {!langCon.language_config.Product_Return_Disclosure__c} <br/>
                                        </i>
                                    </p>

                                    {!langCon.language_config.Products_added_Label__c} <strong style="color:#{!brand_config.Background_Color_Tab_Not_Selected__c}">({!caseProductWrapperList.size})</strong>
                                </apex:outputPanel>

                                <apex:outputPanel layout="block" styleClass="selectedProductResults" id="selectedProductsPanel">

                                    <apex:repeat var="index" value="{!caseProductIndexes}" id="selectedProductsTable">

                                        <table class="{!caseProductWrapperList[index].cp.Local_Product__c} table">
                                            <tr>
                                                <td class="imageColumn" style="width:{!prodImageWidth}px;">
                                                    <apex:image html-lpId="{!caseProductWrapperList[index].cp.Local_Product__c}" styleClass="productThumbnail added{!caseProductWrapperList[index].cp.Local_Product__c}" value="{!IF(ISBLANK(caseProductWrapperList[index].cpImageUrl), defaultProductImageUrl, caseProductWrapperList[index].cpImageUrl)}" width="{!prodImageWidth}" height="{!prodImageHeight}"/>
                                                </td>

                                                <td class="productInfoColumn">
                                                    <p class="productNameText">{!caseProductWrapperList[index].cpName}</p>
                                                    <!-- <p class="productWeightUpcText">{!caseProductWrapperList[index].cpGTIN}</p> -->
                                                </td>

                                                <td class="caseProductInfo">
                                                    <div class="row">
                                                        <!-- Production code -->
                                                        <apex:outputPanel layout="block" styleClass="col-lg-3 colPad">
                                                            
                                                            <div class="row">
                                                                <apex:inputText value="{!caseProductWrapperList[index].cp.Production_Code__c}" styleClass="col-sm-12 productAddedstyle"/>
                                                            </div>

                                                            <div class="row">
                                                                <apex:outputLabel value="{!langCon.language_config.Products_Added_Production_Code__c}">
                                                                    <span class="fa fa-question-circle" title="{!langCon.language_config.Products_Added_Production_Code_Help__c}" alt="{!langCon.language_config.Products_Added_Production_Code_Help__c}"/>
                                                                </apex:outputLabel>
                                                            </div>

                                                        </apex:outputPanel>


                                                        <!-- EXP Date -->
                                                        <apex:outputPanel layout="block" styleClass="col-lg-2 colPad">

                                                            <div class="row">
                                                                <apex:inputText value="{!caseProductWrapperList[index].expDate}" html-placeholder="MM/DD/YYYY" styleClass="expirationDate col-sm-12 productAddedstyle"/>
                                                            </div>

                                                            <div class="row">
                                                                <apex:outputLabel value="{!langCon.language_config.Products_Added_Expiration_Date__c}"/>
                                                            </div>
                                                
                                                        </apex:outputPanel>


                                                        <!-- Quantity -->
                                                        <apex:outputPanel layout="block" styleClass="col-lg-2 colPad">
                                                        
                                                        <div class="row">
                                                            <apex:selectList size="1" value="{!caseProductWrapperList[index].quantity}" styleClass="productAddedstyle"> 
                                                                <apex:selectOption itemValue="1" itemLabel="1"/>
                                                                <apex:selectOption itemValue="2" itemLabel="2"/>
                                                                <apex:selectOption itemValue="3" itemLabel="3"/>
                                                                <apex:selectOption itemValue="4" itemLabel="4"/>
                                                                <apex:selectOption itemValue="5" itemLabel="5"/>
                                                                <apex:selectOption itemValue="6" itemLabel="6"/>
                                                                <apex:selectOption itemValue="7" itemLabel="7"/>
                                                                <apex:selectOption itemValue="8" itemLabel="8"/>
                                                                <apex:selectOption itemValue="9" itemLabel="9"/>
                                                            </apex:selectList>
                                                        </div>

                                                        <div class="row">
                                                            <apex:outputLabel value="{!langCon.language_config.Products_Added_Quantity__c}"/>
                                                        </div>

                                                        </apex:outputPanel>

                                                        <!-- First Time Use -->
                                                        <apex:outputPanel layout="block" styleClass="col-lg-3 colPad">

                                                        <div class="row">
                                                            <apex:inputField value="{!caseProductWrapperList[index].cp.Same_Version__c}" id="sameVersion" styleClass="productAddedstyle avail_for_ret_group-{!caseProductWrapperList[index].cp.Local_Product__c}{!index} sameVersionSelect"/>
                                                        </div>

                                                        <div class="row">
                                                            <apex:outputLabel value="{!langCon.language_config.Products_Added_Same_Version__c}" for="sameVersion">
                                                                <span class="required" style="color:black;font-weight: normal;">&nbsp;*</span>
                                                            </apex:outputLabel>
                                                        </div>
                                                
                                                        </apex:outputPanel>
                                                        <!-- Product_Available_for_Return__c -->
                                                        <apex:outputPanel layout="block" styleClass="col-lg-2 colPad">

                                                        <div class="row">
                                                            <apex:selectList size="1" value="{!caseProductWrapperList[index].availableForReturn}" styleClass="productAddedstyle avail_for_ret_group-{!caseProductWrapperList[index].cp.Local_Product__c}{!index} availableForReturnSelect" id="availableForReturn" >
                                                                <apex:selectOption itemValue="" itemLabel="--None--"/>
                                                                <apex:selectOption itemValue="0" itemLabel="{!langCon.language_config.Toggle_False__c}"/>
                                                                <apex:selectOption itemValue="1" itemLabel="{!langCon.language_config.Toggle_True__c}"/>
                                                            </apex:selectList>
                                                        </div>

                                            

                                                        <div class="row">
                                                            <apex:outputLabel value="{!langCon.language_config.Product_Available_for_Return__c}" for="availableForReturn">
                                                                <span class="required" style="color:black;font-weight: normal;">&nbsp;*</span>
                                                            </apex:outputLabel>
                                                        </div>
                                                        
                                                        </apex:outputPanel>

                                                    </div>
                                                </td>

                                                <td class="addButtonContainer">
                                                    <apex:commandLink html-prodId="{!caseProductWrapperList[index].cp.Local_Product__c}" action="{!removeCaseProduct}" styleClass="addProductButton" reRender="errorMessages, selectedProductsSection" status="sf_ProgressStatus" onclick="assignDeletedId($(this));" oncomplete="countCaseProducts(); processAddedProductsUrls();" >
                                                    <apex:param name="cpRowToRemove" value="{!index}" assignTo="{!cpRowToRemove}"/>

                                                    <span class="fa fa-times-circle fa-2x"/>
                                                    <div class="productAddText">Remove</div>
                                                </apex:commandLink>
                                                </td>

                                            </tr>
                                        </table>
                              
                                    </apex:repeat>
                                </apex:outputPanel>
                                <apex:outputPanel layout="block" styleClass="emailDivider" rendered="{!caseProductWrapperList.size>0}"/>
                            </apex:outputPanel>  <!-- end selected products  -->
                        </div>


                    </div><!-- /#product-rows -->

                    <div class="row">
                        <div class="col-md-6">
                            <label for="comment">{!langCon.language_config.Contact_Us_Please_Enter_Your_Comment__c}</label><span class="required">&nbsp;*</span><br/>
                            {!langCon.language_config.Contact_Us_Comment_SubHeading__c}<br/>
                            <apex:inputTextarea onkeyup="countChar($(this))" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Comment'])" styleClass="form-control commentField required" html-maxlength="4001" id="comment" cols="80" rows="6" value="{!newCase.Summary__c}"/>
                        </div><!-- ./col-md-6 -->
                    </div><!-- ./row -->

                    <!-- Additional Questions -->        
                    <apex:outputPanel rendered="{!additionalQuestions.size>0}" styleClass="initiallyHidden addQSection {!additionalQuestionsSectionClasses}">
                        <div class="emailDivider"></div>
                        <span id="selectedReasonForWriting"><apex:inputHidden value="{!selectedReasonForWritingClass}" /></span>

                        <div class="row row-2col addQrow">
                        
                            <apex:repeat value="{!additionalQuestions}" var="q">
                                <div class="col-xs-12 col-sm-6 col-md-6 addQ cell-2col {!q.reasonsForWritingClasses}">
                                    <label for="additionalQuestion{!q.QuestionNumber}">{!q.Question}</label><br/>
                                    <apex:inputText rendered="{!q.isText}" value="{!q.response}" html-name="additionalQuestion{!q.QuestionNumber}" styleClass="form-control" />
                                    <apex:selectList rendered="{!q.isPicklist}" value="{!q.response}" html-name="additionalQuestion{!q.QuestionNumber}" styleClass="form-control" size="1" >
                                        <apex:selectOptions value="{!q.picklistValues}"/>
                                    </apex:selectList>                                    
                                </div>
                            </apex:repeat>
                        </div>
                    </apex:outputPanel>


                    <!-- CONTACT ADDRESS -->
                    <!-- div id="contactaddress" class="{!IF(newCase.reason == langCon.language_config.Reason_5__c,'', 'hidden')}" title="{!newCase.reason}"-->
                        <apex:actionFunction name="rerenderAddressForm" rerender="addressForm" />
                        <apex:outputPanel id="addressForm" layout="block">
                        <apex:outputPanel id="addressFormInner" layout="block" rendered="{!IF(newCase.reason == langCon.language_config.Reason_4__c,'true', 'false')}" title="{!newCase.reason}">
                        <div class="emailDivider"></div>
                        
                        <!--CDOY WR363 Start of Standard Display for Addresses-->
                        
                        <apex:outputPanel rendered="{!displayFirstAddressOption}">
                            <div class="row row-2col">
                                <div class="col-xs-12 col-sm-6 col-md-6 col-vtab">
                                    <div class="cell-vtab">
                                        <label for="addressline1">{!langCon.language_config.Contact_Us_Address_Line_1__c}</label><span class="required">&nbsp;*</span><br/>
                                        <apex:inputText value="{!primaryAddressAddresLine1}" id="addressline1" styleClass="form-control required addressline1" onchange="setHasBeenVerified('false');" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Address1'])"/>
                                    </div>
                                    <div class="cell-vtab">
                                        <label for="addressline2">{!langCon.language_config.Contact_Us_Address_Line_2__c}</label><br/>
                                        <apex:inputText value="{!primaryAddressAddresLine2}" id="addressline2" styleClass="form-control addressline2" onchange="setHasBeenVerified('false');" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Address2'])"/>
                                    </div>
                                    <div class="cell-vtab">
                                        <label for="citytown">{!langCon.language_config.Contact_Us_City_Town__c}</label><span class="required">&nbsp;*</span><br/>
                                        <apex:inputText value="{!primaryAddressTownCity}" id="citytown" styleClass="form-control required citytown" onchange="setHasBeenVerified('false');" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case City'])"/>
                                    </div>
                                </div>
                                <div class="col-xs-12 col-sm-6 col-md-6 col-vtab">
                                    <div class="cell-vtab">
                                        <label for="stateprovincecounty">{!langCon.language_config.Contact_Us_State_Province_County__c}</label>&nbsp;<span class="required">{!IF(isStateRequired,'*','')}</span><br/>
                                        <apex:inputText value="{!primaryAddressStateProvinceCounty}" id="stateprovincecounty" styleClass="form-control {!IF(isStateRequired, 'required', '')} stateprovince" onchange="setHasBeenVerified('false');" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case State'])"/>
                                    </div>
                                    <div class="cell-vtab">
                                        <label for="zippostalcode">{!langCon.language_config.Contact_Us_Zip_Postal_Code__c}&nbsp;</label><span class="required">{!IF(isZipRequired,'*','')}</span><br/>
                                        <apex:inputText value="{!primaryAddressZipPostalCode}" id="zippostalcode" styleClass="form-control {!IF(isZipRequired, 'required', '')} addresszippostalcode" onchange="setHasBeenVerified('false');" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Zip Code'])"/>
                                    </div>
                                    <div class="cell-vtab">
                                        <label for="country">{!langCon.language_config.Country_Label__c}</label><span class="required">&nbsp;*</span><br/>
                                        <apex:inputField styleClass="form-control required country" id="country" value="{!newContact.Country__c}" onchange="rerenderAddressForm(); _gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Country'])"/>
                                    </div>
                                </div>
                            </div>
                        </apex:outputPanel>
                        <!--CDOY WR363 End of Standard Display for Addresses-->
                        
                        <!--CDOY WR363 Start of Argentina/Germany Display for Addresses-->
                        <apex:outputPanel rendered="{!displaySecondAddressOption}">
                            <div class="row row-2col">
                                <div class="col-xs-12 col-sm-6 col-md-6 col-vtab">
                                    <div class="cell-vtab">
                                        <label for="addressline1_SecondDisplayOption">{!langCon.language_config.Contact_Us_Address_Line_1__c}</label><span class="required">&nbsp;*</span><br/>
                                        <apex:inputText value="{!primaryAddressAddresLine1}" id="addressline1_SecondDisplayOption" styleClass="form-control required addressline1" onchange="setHasBeenVerified('false');" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Address1'])"/>
                                    </div>
                                    <div class="cell-vtab">
                                        <label for="addressline2_SecondDisplayOption">{!langCon.language_config.Contact_Us_Address_Line_2__c}</label><br/>
                                        <apex:inputText value="{!primaryAddressAddresLine2}" id="addressline2_SecondDisplayOption" styleClass="form-control addressline2" onchange="setHasBeenVerified('false');" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Address2'])"/>
                                    </div>
                                    <div class="cell-vtab">
                                        <label for="zippostalcode_SecondDisplayOption">{!langCon.language_config.Contact_Us_Zip_Postal_Code__c}&nbsp;</label><span class="required">{!IF(isZipRequired,'*','')}</span><br/>
                                        <apex:inputText value="{!primaryAddressZipPostalCode}" id="zippostalcode_SecondDisplayOption" styleClass="form-control {!IF(isZipRequired, 'required', '')} addresszippostalcode" onchange="setHasBeenVerified('false');" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Zip Code'])"/>
                                    </div>
                                </div>
                                <div class="col-xs-12 col-sm-6 col-md-6 col-vtab">
                                    <div class="cell-vtab">
                                        <label for="citytown_SecondDisplayOption">{!langCon.language_config.Contact_Us_City_Town__c}</label><span class="required">&nbsp;*</span><br/>
                                        <apex:inputText value="{!primaryAddressTownCity}" id="citytown_SecondDisplayOption" styleClass="form-control required citytown" onchange="setHasBeenVerified('false');" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case City'])"/>
                                    </div>
                                    <div class="cell-vtab">
                                        <label for="stateprovincecounty_SecondDisplayOption">{!langCon.language_config.Contact_Us_State_Province_County__c}</label>&nbsp;<span class="required">{!IF(isStateRequired,'*','')}</span><br/>
                                        <apex:inputText value="{!primaryAddressStateProvinceCounty}" id="stateprovincecounty_SecondDisplayOption" styleClass="form-control {!IF(isStateRequired, 'required', '')} stateprovince" onchange="setHasBeenVerified('false');" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case State'])"/>
                                    </div>
                                    <div class="cell-vtab">
                                        <label for="country_SecondDisplayOption">{!langCon.language_config.Country_Label__c}</label><span class="required">&nbsp;*</span><br/>
                                        <apex:inputField styleClass="form-control required country" id="country_SecondDisplayOption" value="{!newContact.Country__c}" onchange="rerenderAddressForm(); _gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Country'])"/>
                                    </div>
                                </div>
                            </div>
                        </apex:outputPanel>
                        <!--CDOY WR363 End of Argentina/Germany Display for Addresses-->

                        <!--CDOY WR363 Start of China Display for Addresses-->
                        <apex:outputPanel rendered="{!displayThirdAddressOption}">
                            <div class="row row-2col">
                                <div class="col-xs-12 col-sm-6 col-md-6 col-vtab">
                                    <div class="cell-vtab">
                                        <label for="addressline1_ThirdDisplayOption">{!langCon.language_config.Contact_Us_Address_Line_1__c}</label><span class="required">&nbsp;*</span><br/>
                                        <apex:inputText value="{!primaryAddressAddresLine1}" id="addressline1_ThirdDisplayOption" styleClass="form-control required addressline1" onchange="setHasBeenVerified('false');" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Address1'])"/>
                                    </div>
                                    <div class="cell-vtab">
                                        <label for="addressline2_ThirdDisplayOption">{!langCon.language_config.Contact_Us_Address_Line_2__c}</label><br/>
                                        <apex:inputText value="{!primaryAddressAddresLine2}" id="addressline2_ThirdDisplayOption" styleClass="form-control addressline2" onchange="setHasBeenVerified('false');" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Address2'])"/>
                                    </div>
                                    <div class="cell-vtab">
                                        <label for="citytown_ThirdDisplayOption">{!langCon.language_config.Contact_Us_City_Town__c}</label><span class="required">&nbsp;*</span><br/>
                                        <apex:inputText value="{!primaryAddressTownCity}" id="citytown_ThirdDisplayOption" styleClass="form-control required citytown" onchange="setHasBeenVerified('false');" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case City'])"/>
                                    </div>

                                </div>
                                <div class="col-xs-12 col-sm-6 col-md-6 col-vtab">
                                    <div class="cell-vtab">
                                        <label for="zippostalcode_ThirdDisplayOption">{!langCon.language_config.Contact_Us_Zip_Postal_Code__c}&nbsp;</label><span class="required">{!IF(isZipRequired,'*','')}</span><br/>
                                        <apex:inputText value="{!primaryAddressZipPostalCode}" id="zippostalcode_ThirdDisplayOption" styleClass="form-control {!IF(isZipRequired, 'required', '')} addresszippostalcode" onchange="setHasBeenVerified('false');" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Zip Code'])"/>
                                    </div>
                                    <div class="cell-vtab">
                                        <label for="stateprovincecounty_ThirdDisplayOption">{!langCon.language_config.Contact_Us_State_Province_County__c}</label>&nbsp;<span class="required">{!IF(isStateRequired,'*','')}</span><br/>
                                        <apex:inputText value="{!primaryAddressStateProvinceCounty}" id="stateprovincecounty_ThirdDisplayOption" styleClass="form-control {!IF(isStateRequired, 'required', '')} stateprovince" onchange="setHasBeenVerified('false');" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case State'])"/>
                                    </div>
                                    <div class="cell-vtab">
                                        <label for="country_ThirdDisplayOption">{!langCon.language_config.Country_Label__c}</label><span class="required">&nbsp;*</span><br/>
                                        <apex:inputField styleClass="form-control required country" id="country_ThirdDisplayOption" value="{!newContact.Country__c}" onchange="rerenderAddressForm(); _gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Country'])"/>
                                    </div>
                                </div>
                            </div>
                        </apex:outputPanel>
                        <!--CDOY WR363 End of China Display for Addresses-->
                        
                        <!--CDOY WR363 Start of Japan Display for Addresses-->
                        <apex:outputPanel rendered="{!displayFourthAddressOption}">
                            <div class="row row-2col">
                                <div class="col-xs-12 col-sm-6 col-md-6 col-vtab">
                                    <div class="cell-vtab">
                                        <label for="zippostalcode_FourthDisplayOption">{!langCon.language_config.Contact_Us_Zip_Postal_Code__c}&nbsp;</label><span class="required">{!IF(isZipRequired,'*','')}</span><br/>
                                        <apex:inputText value="{!primaryAddressZipPostalCode}" id="zippostalcode_FourthDisplayOption" styleClass="form-control {!IF(isZipRequired, 'required', '')} addresszippostalcode" onchange="setHasBeenVerified('false');" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Zip Code'])"/>
                                    </div>
                                    <div class="cell-vtab">
                                        <label for="stateprovincecounty_FourthDisplayOption">{!langCon.language_config.Contact_Us_State_Province_County__c}</label>&nbsp;<span class="required">{!IF(isStateRequired,'*','')}</span><br/>
                                        <apex:inputText value="{!primaryAddressStateProvinceCounty}" id="stateprovincecounty_FourthDisplayOption" styleClass="form-control {!IF(isStateRequired, 'required', '')} stateprovince" onchange="setHasBeenVerified('false');" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case State'])"/>
                                    </div>
                                    <div class="cell-vtab">
                                        <label for="citytown_FourthDisplayOption">{!langCon.language_config.Contact_Us_City_Town__c}</label><span class="required">&nbsp;*</span><br/>
                                        <apex:inputText value="{!primaryAddressTownCity}" id="citytown_FourthDisplayOption" styleClass="form-control required citytown" onchange="setHasBeenVerified('false');" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case City'])"/>
                                    </div>
                                </div>
                                <div class="col-xs-12 col-sm-6 col-md-6 col-vtab">
                                    <div class="cell-vtab">
                                        <label for="addressline1_FourthDisplayOption">{!langCon.language_config.Contact_Us_Address_Line_1__c}</label><span class="required">&nbsp;*</span><br/>
                                        <apex:inputText value="{!primaryAddressAddresLine1}" id="addressline1_FourthDisplayOption" styleClass="form-control required addressline1" onchange="setHasBeenVerified('false');" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Address1'])"/>
                                    </div>
                                    <div class="cell-vtab">
                                        <label for="addressline2_FourthDisplayOption">{!langCon.language_config.Contact_Us_Address_Line_2__c}</label><br/>
                                        <apex:inputText value="{!primaryAddressAddresLine2}" id="addressline2_FourthDisplayOption" styleClass="form-control addressline2" onchange="setHasBeenVerified('false');" onfocus="_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Address2'])"/>
                                    </div>
                                   <div class="cell-vtab">
                                        <label for="country_FourthDisplayOption">{!langCon.language_config.Country_Label__c}</label><span class="required">&nbsp;*</span><br/>
                                        <apex:inputField styleClass="form-control required country" id="country_FourthDisplayOption" value="{!newContact.Country__c}" onchange="rerenderAddressForm(); _gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Country'])"/>
                                    </div>
                                </div>
                            </div>
                        </apex:outputPanel>
                        <!--CDOY WR363 End of Japan Display for Addresses-->
                        
                        <apex:inputHidden value="{!overridePrimaryAddress}" id="overrideaddress"/>
                    <!--/div-->
                    
                    </apex:outputPanel>
                    </apex:outputPanel>
                    
                    <!-- END CONTACT ADDRESS -->
                 
                    <!-- ATTACHMENTS -->
                     <div class="row attachments" id="attachments">
                        <div class="emailDivider"></div>
                        <div class="col-md-6">
                        
                            <label for="comment">{!langCon.language_config.Contact_Us_Attachements_Label__c}</label><br/>
                                {!langCon.language_config.Contact_Us_Attachements_Description__c}<br/> 
                            <input type="file" id="attachmentFile" onchange="uploadFile()"/>
                            <p>
                                <span id="attachmentName" style="font-weight:bold"/>
                            </p> 
                            <apex:inputHidden value="{!attachmentId}" id="caseAttachmentId"/>
                            <apex:inputHidden value="{!attachmentErrors}" id="attachmentErrorMsgs" />
                            <div id="progressbar"></div>
                        </div>
                    </div>
                    <!-- END ATTACHMENTS -->
                </div>

                <div class="pull-left required italic">
                    {!langCon.language_config.Contact_Us_Mandatory_Fields_Key__c}
                </div>
                <div id="clearfix1" class="clearfix"></div>

                <div class="row pull-right">
                    <div class="col-md-12">
                        
                        <!--CDOY WR172 Below is the acceptTsCs line that was changed
                        <label for="acceptTsCs">{!langCon.language_config.Accept_Terms_and_Conditions_Label_Part_1__c} <a href="{!langCon.language_config.I_Agree_Url__c}" target="_blank">{!langCon.language_config.Accept_Terms_and_Conditions_Label_Part_2__c}</a>{!langCon.language_config.Accept_Terms_and_Conditions_Label_Part_3__c}</label><span class="required">&nbsp;*</span>
                         -->
                         
                        <!--CDOY WR172 Added style="font-size:11px" to the text below
                            CDOY WR172 Also changed the location of the Accept Terms and Conditions Label from Language to Brand Language.
                        --> 
                        <label for="acceptTsCs" style="font-size:14px">{!langCon.brand_language_config.Accept_Terms_and_Conditions_Label_Part_1__c} <a href="{!langCon.brand_language_config.I_Agree_Url__c}" target="_blank" style="font-size:14px">{!langCon.brand_language_config.Accept_Terms_and_Conditions_Label_Part_2__c}</a>{!langCon.brand_language_config.Accept_Terms_and_Conditions_Label_Part_3__c}</label><span class="required">&nbsp;*</span>
                       
                        
                        <apex:inputCheckbox id="acceptTsCs" value="{!newCase.Terms_and_Conditions_Accepted__c}"
                            styleClass="form-control required" style="display:inline; width:20px; margin-left: 3px; height: 16px;" onchange="toggleSubmitButton($(this));_gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Privacy'])"/>
                    </div><!-- ./.col-md-5 -->
                    <div class="col-md-5">
                        <!--&nbsp;-->
                    </div><!-- ./col-md-5 -->
                </div><!-- ./row -->
                <div id="clearfix2" class="clearfix"></div>
            
                <div class="pull-right " id="submitDiv">
                    <apex:actionFunction action="{!save}" name="submitForm" status="sf_ProgressStatus" reRender="errorMessages" oncomplete="init()"/>
                    <!-- <apex:commandButton onclick="$('[id*=sf_ProgressStatus\\.start]').show(); validateForm(); return false;" id="submitButton" disabled="true" value="{!langCon.language_config.Button_Label_Submit__c}" styleClass="btn-custom"/> -->
                    <input type="button" value="{!langCon.language_config.Button_Label_Submit__c}" class="btn-custom" id="submitButton" disabled="true" onclick="$('[id*=sf_ProgressStatus\\.start]').show(); $(this).attr('disabled','disabled'); validateForm(); _gaq.push(['_trackEvent', 'Event_Form_Interaction', 'Event_Field_Focus', 'Case Submit']);" />
                </div>
                
                <div id="clearfix3" class="clearfix"></div>

                    <div id="uncorrectedAddressConfirmation" title=""  style="min-height: 180px;">
                        <p>{!langCon.language_config.Contact_Us_Invalid_Address__c}</p>

                        <div id="confirmEnteredAddress" style="font-weight:bold;" />

                      <!--   <br/>
                        {!langCon.language_config.Contact_Us_Want_To_Continue__c} -->
                    </div>
                <div style="display:none;">
                    <div id="addressconfirmation" >                
                        <div class="dialogClass">
                            <table>
                                <tr>
                                    <td colspan="2">
                                        <br/>
                                    </td>
                                </tr>
                                <tr>
                                    <td><input type="radio" name="addressInput" id="rdoUserInput" /></td>
                                    <td><b>{!langCon.language_config.Contact_Us_Keep_Entered_Address__c}</b></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td>
                                        <div id="divAddressByUser"></div><br/>                            
                                    </td>
                                </tr>
                                
                                <tr>
                                    <td><input type="radio" name="addressInput" id="rdoSuggestedInput" /></td>
                                    <td><b>{!langCon.language_config.Contact_Us_Suggested_Address__c}</b></td>
                                </tr>
                                <tr> 
                                    <td></td>
                                    <td>  
                                        <div id="divAddressByService"></div><br/>                          
                                    </td>
                                </tr>                        
                                <tr>
                                    <td colspan="2">
                                        <br/>
                                    </td>
                                </tr>
                            </table>
                            <apex:inputHidden value="{!serviceSuggestedAddressLine1}"       id="serviceAddressLine1"/>
                            <apex:inputHidden value="{!serviceSuggestedAddressLine2}"       id="serviceAddressLine2"/>
                            <apex:inputHidden value="{!serviceSuggestedAddressLine3}"       id="serviceAddressLine3"/>
                            <apex:inputHidden value="{!serviceSuggestedAddressCity}"        id="serviceAddressCity"/>
                            <apex:inputHidden value="{!serviceSuggestedAddressState}"   id="serviceAddressState"/>
                            <apex:inputHidden value="{!serviceSuggestedAddressZip}"     id="serviceAddressZip"/>
                        </div>
                    </div>
                </div>
                
                <input id="hasBeenVerified" type="hidden" value=""/>
                
            </apex:form>
        </apex:define>
    </apex:composition>

    <apex:actionStatus id="sf_ProgressStatus">
        <apex:facet name="start">
            <apex:outputPanel layout="block" styleClass="waiting" id="el_loading">
                <apex:outputPanel layout="block" styleClass="waitingHolder">
                    <span class="fa fa-spinner fa-spin fa-2x"/>
                </apex:outputPanel>
            </apex:outputPanel>

        </apex:facet>
    </apex:actionStatus>
    <!-- <c:sf_ProgressStatus labelText="Loading..."/> -->
        <style>

    .waiting {

        height: 100%;
        left: 0;
        position: fixed;
        top: 0;
        opacity: 0.7;
        -moz-opacity: 0.7;
        width: 100%;
        -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=70)";
        filter: alpha(opacity=70);
        background: #fff;
        -khtml-opacity: 0.7;
        z-index: 9000;

    }

    .waitingHolder {
        position: absolute;
        left: 50%;
        top: 50%;
    }

    /*Search results style*/
    .searchResultRow {
        background: #eeeeee;
        text-align: left;
    }
    .searchResultCol {
        padding: 20px 20px 10px 20px;
    }

    .rich-table-thead {
        border-bottom: 0px !important;
    }

    .searchButton {
        float: left;
        height: 31px;
        margin-left: 9px;
        width: 117px;
    }

    /* fix bootstrap bug affecting reason for writing */
    #page-body select[size="1"] {
        height: 34px !important;
    }

    .fa:hover {
        /*
        if hover over is needed
        */
    }

    .fa {
        cursor: pointer;
        //color: #{!brand_config.Background_Color_Tab_Selected__c};
    }

    .fa-question-circle {
        cursor: pointer;
        color: #{!brand_config.Font_Color_Page_Title__c};
    }

    .pointerArrow span {
        cursor: pointer;
    }
    /* END toggle styling */

    /* START dialog styling */
    .dialog-btn-custom {
        background: none repeat scroll 0 0 #7F7F7D;
        border: medium none;
        border-radius: 3px;
        color: #FFFFFF;
        line-height: normal;
        padding: 10px;
    }
    
    .dialog-btn-custom:hover {
        background: none repeat scroll 0 0 #B7B7B4;
        border: medium none;
        border-radius: 3px;
        color: #FFFFFF;
        line-height: normal;
        padding: 10px;
    }

    .btn-custom {
        font-weight: normal;
    }

    /*.ui-widget-header {
        background: #7F7F7D;
        border: 0;
        color: #FFFFFF;
        font-weight: normal;
    }*/

    .ui-widget-header {
        background: #{!brand_config.Background_Color_Header__c} !important;
        color: #{!brand_config.Font_Color_Header__c};
        font-family: "{!brand_config.Font_Header__c}";
        font-size: {!brand_config.Font_Size_Header__c};
        border-bottom:2px solid #{!brand_config.Header_Bottom_Border_Color__c}; 
        font-weight: normal; 
    }

    .ui-dialog {
        left: 0;
        outline: 0 none;
        padding: 0 !important;
        position: absolute;
        top: 0;
    }
        
    .ui-widget-overlay {
        background: #000;
    }

    .no-close .ui-dialog-titlebar-close {
        display: none;
    }
    
    .dialogClass{
        color: #{!brand_config.Background_Color_Header__c}; /*000000;*/
    }

    #progressbar .ui-progressbar-value {
        background-color: #{!brand_config.Background_Color_Header__c};
    }
    
    .dialogClass table{
        border-spacing: 10px;
        border-collapse: separate;
    }
    
    .dialogClass td{
        padding: 2px;
    }
    /* END dialog styling */
    
    .popupClass{
        font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
        font-size: 14px;
    }

    #validationError {
        font-family: "Trebuchet MS";
        font-weight: bold;
        color: #ad1c1c;
        font-size: {!lang_config.Error_Message_Font_Size__c};
        background: #ffdbdb;
        padding: 20px;
    }
    
    .cell-2col, .cell-vtab{
       padding: 15px 15px 15px 15px;
    }
    
    .addQrow {
       margin-top: -15px;
    }
    
    .cell-2col span.error {
        position: absolute;
        padding-top: 3px;
    }
    
    .col-vtab {
        padding: 0;
        margin: 0;
    }

    .colPad {
        padding-right: 5px;
    }
    
    .initiallyHidden {
        display: none;
    }   

    .row-2col {
       margin-left: -15px;
       margin-right: -15px;
    } 
    
    .productAddedstyle {
    display: block;
    width: 100%;
    height: 34px;
    padding: 5px 5px !important;
    font-size: 14px;
    line-height: 1.42857143;
    color: #555;
    background-color: #fff;
    background-image: none;
    border: 1px solid #ccc;
    border-radius: 4px;
    -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,0.075);
    box-shadow: inset 0 1px 1px rgba(0,0,0,0.075);
    -webkit-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
    -o-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
    transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
}



}
    

    </style>
    


    <script type="text/javascript">

         $(function() {
            
            $( "#addressconfirmation" ).dialog({
                    autoOpen: false,
                    width: 400,
                    title: "{!JSENCODE(langCon.language_config.Contact_Us_Address_Verification__c)}", //CDOY WR288 JSENCODE Added to JS
                    position: ['top',100],
                    modal: true,
                    dialogClass: "no-close popupClass",
                    show: {effect: "blind"},
                    buttons: {
                        "{!JSENCODE(langCon.language_config.Cancel__c)}": { //CDOY WR288 JSENCODE Added to JS
                            text: '{!JSENCODE(langCon.language_config.Cancel__c)}', //CDOY WR288 JSENCODE Added to JS
                            "class": 'btn-custom',
                            click: function() {
                                $('[id$=acceptTsCs]').prop('checked', false);
                                $("#addressconfirmation").dialog("close");
                                //setHasBeenVerified('true');
                                //confirmAddress.dialog( "close" );
                            }
                        },
                        "{!JSENCODE(langCon.language_config.Contact_Us_Continue__c)}": { //CDOY WR288 JSENCODE Added to JS
                            text: '{!JSENCODE(langCon.language_config.Contact_Us_Continue__c)}', //CDOY WR288 JSENCODE Added to JS
                            "class": 'btn-custom',
                            click: function(){
                                if($("#rdoSuggestedInput").prop('checked')){
                                    onSuggestedAddressSelected('', '{!langCon.language_config.Country__c}');
                                    directSubmitForm();
                                }else if($("#rdoUserInput").prop('checked')){
                                    directSubmitForm();
                                }
                                
                            }
                        }
                    }
              });
            
            var confirmAddress = $( "#uncorrectedAddressConfirmation" ).dialog({

                resizable: false,
                height:300,
                width: 380,
                title: "{!JSENCODE(langCon.language_config.Contact_Us_Address_Verification__c)}", //CDOY WR288 JSENCODE Added to JS
                modal: true,
                autoOpen: false,
                dialogClass: 'no-close popupClass',
                buttons: {
                    "{!JSENCODE(langCon.language_config.Contact_Us_Address_Dialog_No__c)}": { //CDOY WR288 JSENCODE Added to JS
                        text: '{!JSENCODE(langCon.language_config.Contact_Us_Address_Dialog_No__c)}', //CDOY WR288 JSENCODE Added to JS
                        "class": 'btn-custom',
                        click: function() {
                            $('[id$=acceptTsCs]').prop('checked', false);
                            setHasBeenVerified('true');
                            confirmAddress.dialog( "close" );
                        }
                    },
                    "{!JSENCODE(langCon.language_config.Contact_Us_Address_Dialog_Yes__c)}": { //CDOY WR288 JSENCODE Added to JS
                        text: '{!JSENCODE(langCon.language_config.Contact_Us_Address_Dialog_Yes__c)}', //CDOY WR288 JSENCODE Added to JS
                        "class": 'btn-custom',
                        click: function () {
                            directSubmitForm();
                            confirmAddress.dialog( "close" );
                        }
                    }
                }
            });
        });
        
        var validateForm = function () {
            
            $('#validationError').hide();
            var isFormValid = $('[id$=contactUsForm]').valid();
            
            var psr = productSearchRequired();
            
            if (isFormValid && psr) {

                var reasonForWriting = $('.reasonForWriting').val();
                var emailFieldVal = $('.emailField').val();
                var addressLine1 = '';
                var addressLine2 = '';
                var addressLine3 = '';
                var addressZipPostalCode = '';
                var addressCityTown = '';
                var addressStateProvince = '';
                var addressCountry = '';
                
                if(reasonForWriting == '{!JSENCODE(langCon.language_config.Reason_4__c)}'){ //CDOY WR288 JSENCODE Added to JS
                    addressLine1 = $('.addressline1').val();
                    addressLine2 = $('.addressline2').val();
                    addressLine3 = $('.addressline3').val();
                    addressZipPostalCode = $('.addresszippostalcode').val();
                    addressCityTown = $('.citytown').val();
                    addressStateProvince = $('.stateprovince').val();
                    addressCountry = $('.country').val();
                }
                console.log('""""""""');
                sf_EmailUsExt.strikeIronFormValidation(
                    $('.emailField').val(),
                    addressLine1,
                    addressLine2,
                    '',
                    addressZipPostalCode,
                    addressCityTown,
                    addressStateProvince,
                    addressCountry,
                    function(result, event){
                        if(event.status) {
                            var emailValidationStatusNbr = result.emailValidationStatusNumber;
                            var addressValidationStatusNbr = result.addressValidationStatusNumber;

                            // If there are errors in the email validation
                            if (emailValidationStatusNbr == '300' || emailValidationStatusNbr == '310' || emailValidationStatusNbr == '400') {
                    
                                var errors = {
                                    'contactUsPage\\:ContactUsTemplate\\:contactUsForm\\:email' : '{!JSENCODE(langCon.language_config.invalid_email_message__c)}' //CDOY WR288 JSENCODE Added to JS
                                };

                                validator.showErrors(errors);
                                $('#validationError').show();
                                //$('#submitButton').removeAttr('disabled');
                                $('[id$=acceptTsCs]').prop('checked', false);
                                $('[id*=sf_ProgressStatus\\.start]').hide();
                                $('.emailField').focus(); 
                            }
                            // If the email is validated, then validate the address (Only if reason is Share your concern)
                            else if(reasonForWriting == '{!JSENCODE(langCon.language_config.Reason_4__c)}'){ //CDOY WR288 JSENCODE Added to JS
                                
                                //If the address validation return the following code, the address might be invalid
                                 if(addressValidationStatusNbr == '222' || addressValidationStatusNbr == '300' || addressValidationStatusNbr == '323'
                                    || addressValidationStatusNbr == '324' || addressValidationStatusNbr == '325' || addressValidationStatusNbr == '401'){
                                    
                                
                                    
                                    // If the user had already been asked to verify the address, submit the form directly
                                    if($('#hasBeenVerified').val() === 'true'){
                                            setHasBeenVerified('');
                                            $("[id$='overrideaddress']").val('true'); 
                                            submitForm();
                                    } else{ // else the user hasnt been asked to verify the address, display the popup
                                        
                                        // If the StrikeIron service corrected the address
                                        if(addressValidationStatusNbr == '222'){
                                            setSuggestedAddressVariables(result.validatedAddress1, result.validatedAddress2, result.validatedAddress3, result.validatedCity, result.validatedState, result.validatedZip);
                                            openConfirmationDialog(result.formattedUserInputWithHTMLBreaksAndColors, result.formattedAddressWithHTMLBreaks);

                                            $('[id*=sf_ProgressStatus\\.start]').hide();
                                        } else{ // strikeIron could not correct the address

                                            //CDOYWR363  START
                                            var enteredAddress = getAddressStringByCountry($('.addressline1').val(), $('.addressline2').val(), $('.citytown').val(), $('.stateprovince').val(), $('.addresszippostalcode').val(), $('.country').val() )
                                            /*
                                            var enteredAddress
                                              
                                            
                                            var enteredAddress = $('.addressline1').val() + '<br/>';
                                            
                                            if ($('.addressline2').val() != '')
                                            enteredAddress += $('.addressline2').val() + '<br/>';
                                            
                                            if ($('.addressline3').val() != '')
                                            enteredAddress += $('.addressline3').val() + '<br/>';
                                            enteredAddress += $('.citytown').val() + ', ' + $('.stateprovince').val() + ' ';
                                            enteredAddress += $('.addresszippostalcode').val() + '<br/>';
                                            */
                                            
                                            console.log('***CDOY enteredAddress = '+ enteredAddress);

                                            $('#confirmEnteredAddress').html(enteredAddress);

                                            //confirmEnteredAddress add address
                                            
                                            $( "#uncorrectedAddressConfirmation" ).dialog("open");
                                            $('[id*=sf_ProgressStatus\\.start]').hide();

                                        }
                                    }
                                }
                                // Here, the address validation has returned an acceptable code.
                                else {
                                     
                                        // If the returned code is 222, it means strikeIron has corrected the submitted address.
                                        // Set the Corrected Address in the form before saving
                                        if(addressValidationStatusNbr == '222'){
                                                $('.addressline1').val(result.validatedAddress1);
                                                $('.addressline2').val(result.validatedAddress2);
                                                $('.addressline3').val(result.validatedAddress3);
                                                
                                                $('.citytown').val(result.validatedCity);
                                                $('.stateprovince').val(result.validatedState);
                                                $('.addresszippostalcode').val(result.validatedZip);
                                        }

                                        // Submit the form
                                        $("[id$='overrideaddress']").val('');
                                        $('#validationError').hide();
                                        submitForm();
                                }
                            }
                            // If the reason is not Share your concern, and the email has been validated, submit the form.
                            else{
                                
                                $('#validationError').hide();
                                submitForm();
                                
                            }
                        } else {
                            console.log ('validateEmailAddress error ', event.message);
                            //$('#validationError').html(event.message);
                        }                           
                    }
                );                                
            } else { //form is invalid;
                $('#validationError').show();
                //$('#submitButton').removeAttr('disabled');
                $('[id$=acceptTsCs]').prop('checked', false);
                $('[id*=sf_ProgressStatus\\.start]').hide();
            }

            
        };
    </script>

</apex:page>